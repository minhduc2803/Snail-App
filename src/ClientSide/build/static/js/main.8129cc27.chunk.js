(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{127:function(e,t,n){e.exports=n(212)},132:function(e,t,n){},139:function(e,t,n){},141:function(e,t,n){},176:function(e,t,n){},178:function(e,t,n){},180:function(e,t,n){},182:function(e,t,n){},185:function(e,t,n){},187:function(e,t,n){},189:function(e,t,n){},208:function(e,t,n){},210:function(e,t,n){},212:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(47),o=n.n(c),s=(n(132),n(2));n(139);function i(){return r.a.createElement("div",{className:"conversation-search"},r.a.createElement("input",{type:"search",className:"conversation-search-input",placeholder:"Search Messages"}))}var l=n(121),u=n(126);n(141);function m(e){Object(a.useEffect)(function(){Object(l.a)(".conversation-snippet",20)});var t=Object(s.c)(function(e){return e.chosenIndex}),n=Object(s.b)(),c=e.data,o=c.index,i=(c.photo,c.name),m=c.text,d="conversation-list-item "+(o===t?"chosen-conversation":"");return console.log(d),r.a.createElement("div",{className:"".concat(d),onClick:function(){return n({type:"CHOOSE_CONVERSATION",chosenIndex:o})}},r.a.createElement(u.a,{name:"".concat(i),size:"40",round:!0}),r.a.createElement("div",{className:"conversation-info"},r.a.createElement("h1",{className:"conversation-title"},i),r.a.createElement("p",{className:"conversation-snippet"},m)))}n(176);function d(e){var t=e.title,n=e.leftItems,a=e.rightItems;return r.a.createElement("div",{className:"toolbar"},r.a.createElement("div",{className:"left-items"},n),r.a.createElement("h1",{className:"toolbar-title"},t),r.a.createElement("div",{className:"right-items"},a))}n(178);function f(e){var t=e.icon;return r.a.createElement("i",{className:"toolbar-button ".concat(t)})}n(180);function p(e){var t=Object(s.c)(function(e){return e.listUsers}).map(function(e,t){return{index:t,photo:"#",name:"".concat(e.Fullname),text:void 0!==e.chat&&void 0!==e.chat[e.chat.length-1]?"".concat(e.chat[e.chat.length-1].Content):"Say hello to ".concat(e.Fullname)}});return r.a.createElement("div",{className:"conversation-list"},r.a.createElement(d,{title:"Messenger",leftItems:[r.a.createElement(f,{key:"cog",icon:"ion-ios-cog"})],rightItems:[r.a.createElement(f,{key:"add",icon:"ion-ios-add-circle-outline"})]}),r.a.createElement(i,null),t.map(function(e){return r.a.createElement(m,{key:e.index,data:e})}))}var h=n(7);n(182);function v(e){var t=Object(s.c)(function(e){return e.websocket}),n=Object(s.c)(function(e){return e.listUsers[e.chosenIndex]}),a=Object(s.c)(function(e){return e.user}),c=r.a.useRef(null);return r.a.createElement("div",{className:"compose"},r.a.createElement("input",{type:"text",ref:c,className:"compose-input",placeholder:"Type a message, @name",onKeyPress:function(e){!function(e){if(console.log("yup enter chat"),"Enter"===e.key){var r={Mode:1,UserSendID:a.userID,UserReceiveID:n.UserID,Content:c.current.value};c.current.value="",t.send(JSON.stringify(r))}}(e)}}),e.rightItems)}var E=n(18),g=n.n(E);n(185);function b(e){var t=e.data,n=e.isMine,a=e.startsSequence,c=e.endsSequence,o=e.showTimestamp,s=g()(t.timestamp).format("LLLL");return r.a.createElement("div",{className:["message","".concat(n?"mine":""),"".concat(a?"start":""),"".concat(c?"end":"")].join(" ")},o&&r.a.createElement("div",{className:"timestamp"},s),r.a.createElement("div",{className:"bubble-container"},r.a.createElement("div",{className:"bubble",title:s},t.message)))}n(187);function O(e){var t=Object(s.c)(function(e){return e.listUsers[e.chosenIndex]});void 0===t&&(t={chat:[]}),void 0===t.chat&&(t=Object(h.a)({},t,{chat:[]}));var n=Object(s.c)(function(e){return e.user}),a=n.fullname;console.log(t);var c=t.chat.map(function(e,a){return{id:a+1,author:e.UserSendID===n.userID?n.fullname:t.Fullname,message:e.Content,timestamp:e.SentTime}});console.log(c);return r.a.createElement("div",{className:"message-list"},r.a.createElement(d,{title:"".concat(t.Fullname),rightItems:[r.a.createElement(f,{key:"info",icon:"ion-ios-information-circle-outline"}),r.a.createElement(f,{key:"video",icon:"ion-ios-videocam"}),r.a.createElement(f,{key:"phone",icon:"ion-ios-call"})]}),r.a.createElement("div",{className:"message-list-container"},function(){for(var e=0,t=c.length,n=[];e<t;){var o=c[e-1],s=c[e],i=c[e+1],l=s.author===a,u=g()(s.timestamp),m=!0,d=!0,f=!0;if(o){var p=g()(o.timestamp),h=g.a.duration(u.diff(p));o.author===s.author&&h.as("hours")<1&&(m=!1),h.as("hours")<1&&(f=!1)}if(i){var v=g()(i.timestamp),E=g.a.duration(v.diff(u));i.author===s.author&&E.as("hours")<1&&(d=!1)}n.push(r.a.createElement(b,{key:e,isMine:l,startsSequence:m,endsSequence:d,showTimestamp:f,data:s})),e+=1}return n}()),r.a.createElement(v,{rightItems:[r.a.createElement(f,{key:"photo",icon:"ion-ios-camera"}),r.a.createElement(f,{key:"image",icon:"ion-ios-image"}),r.a.createElement(f,{key:"audio",icon:"ion-ios-mic"}),r.a.createElement(f,{key:"money",icon:"ion-ios-card"}),r.a.createElement(f,{key:"games",icon:"ion-logo-game-controller-b"}),r.a.createElement(f,{key:"emoji",icon:"ion-ios-happy"})]}))}n(189);var y=n(32),N=n.n(y);function S(e,t){return function(n,a){n({type:"START_LOGIN",username:e});var r={Username:e,Password:t};return r=JSON.stringify(r),N()({method:"post",url:"http://localhost:8055/api/public/login",headers:{"Content-Type":"application/json"},data:r,validateStatus:function(){return!0}}).then(function(e){if(200!==e.status)alert(e.data.message);else{var t={userID:e.data.data.UserID,username:a().user.username,fullname:e.data.data.Fullname,token:e.data.data.token};console.log(e.data),n(function(e){return{type:"ALREADY_LOGIN",user:e}}(t)),n(function(e){return function(t){var n="ws://localhost:9009/chat?token=".concat(e.token),a=new WebSocket(n);a.onopen=function(){console.log("WebSocket is connected")},a.onmessage=function(e){console.log("Receive a mess"),console.log(JSON.parse(e.data)),t({type:"CHAT",chat:JSON.parse(e.data)})},a.onclose=function(){console.log("webSocket is closed")},t({type:"SETUP_WEBSOCKET",websocket:a})}}(t))}}).catch(function(e){})}}function I(e,t){return function(n,a){var r={UserReceiveID:t.UserID};return r=JSON.stringify(r),console.log(r),N()({method:"post",url:"http://localhost:8055/api/protected/list-chat",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a().user.token)},data:r,validateStatus:function(){return!0}}).then(function(t){200!==t.status?alert(t.data.message):n({type:"LOAD_CHAT",chat:t.data.data,index:e})}).catch(function(e){})}}function j(e){var t=Object(s.b)();return t(function(e,t){return N()({method:"get",url:"http://localhost:8055/api/protected/list-user",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t().user.token)},validateStatus:function(){return!0}}).then(function(t){return 200!==t.status?(alert(t.data.message),[]):(e({type:"LOAD_USERS",listUsers:t.data.data}),t.data.data)})}).then(function(e){for(var n=0;n<e.length;n++)t(I(n,e[n]))}),r.a.createElement("div",{className:"messenger"},r.a.createElement("div",{className:"scrollable sidebar"},r.a.createElement(p,null)),r.a.createElement("div",{className:"scrollable content"},r.a.createElement(O,null)))}n(208);function k(e){var t=r.a.useRef(null),n=r.a.useRef(null),a=Object(s.b)();return r.a.createElement("div",{className:"container"},r.a.createElement("section",{id:"content"},r.a.createElement("form",{onSubmit:function(e){!function(e){e.preventDefault();var r=t.current.value,c=n.current.value;a(S(r,c))}(e)}},r.a.createElement("h1",null,"Snail Project"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",ref:t,placeholder:"Username",required:!0,id:"username"})),r.a.createElement("div",null,r.a.createElement("input",{type:"password",ref:n,placeholder:"Password",required:!0,id:"password"})),r.a.createElement("div",null,r.a.createElement("input",{type:"submit",value:"Log in"}),r.a.createElement("button",{className:"example_a",onClick:function(){return a({type:"REGISTER"})}},"Register")))))}n(210);function w(e){var t=r.a.useRef(null),n=r.a.useRef(null),a=r.a.useRef(null),c=Object(s.b)();function o(e){e.preventDefault();var r=t.current.value,o=n.current.value,s=a.current.value;c(function(e,t,n){return function(a){var r={Username:e,Fullname:t,Password:n};return r=JSON.stringify(r),N()({method:"post",url:"http://localhost:8055/api/public/register",headers:{"Content-Type":"application/json"},data:r,validateStatus:function(){return!0}}).then(function(e){200!==e.status?alert(e.data.message):(alert("Register successfully"),a({type:"LOGIN"}))}).catch(function(e){})}}(r,o,s))}return r.a.createElement("div",{className:"container"},r.a.createElement("section",{id:"content"},r.a.createElement("form",{onSubmit:function(e){o(e)}},r.a.createElement("h1",null,"Snail Project"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",ref:t,placeholder:"Username",required:"",id:"username"})),r.a.createElement("div",null,r.a.createElement("input",{type:"text",ref:n,placeholder:"Fullname",required:"",id:"fullname"})),r.a.createElement("div",null,r.a.createElement("input",{type:"password",ref:a,placeholder:"Password",required:"",id:"password"})),r.a.createElement("div",null,r.a.createElement("input",{type:"submit",value:"Register"}),r.a.createElement("button",{className:"example_a",onClick:function(){return c({type:"LOGIN"})}},"Login")))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var U=n(21),R=n(124),L=n(125),T={loginState:"LOGIN",user:{},listUsers:[],chosenIndex:0},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ALREADY_LOGIN":return Object(h.a)({},e,{loginState:"ALREADY_LOGIN",user:t.user});case"LOGIN":return Object(h.a)({},e,{loginState:"LOGIN"});case"REGISTER":return Object(h.a)({},e,{loginState:"REGISTER"});case"START_LOGIN":return Object(h.a)({},e,{user:{username:t.username}});case"LOAD_USERS":return Object(h.a)({},e,{listUsers:t.listUsers});case"LOAD_CHAT":return Object(h.a)({},e,{listUsers:e.listUsers.map(function(e,n){return n===t.index?Object(h.a)({},e,{chat:t.chat}):e})});case"SETUP_WEBSOCKET":return Object(h.a)({},e,{websocket:t.websocket});case"CHAT":return Object(h.a)({},e,{listUsers:e.listUsers.map(function(e,n){return e.UserID===t.chat.UserSendID||e.UserID===t.chat.UserReceiveID?(e.chat.push(t.chat),Object(h.a)({},e,{chat:e.chat})):e})});case"CHOOSE_CONVERSATION":return Object(h.a)({},e,{chosenIndex:t.chosenIndex});default:return e}},A=Object(U.c)(D,Object(U.a)(R.a,Object(L.createLogger)()));o.a.render(r.a.createElement(s.a,{store:A},r.a.createElement(function(){var e=Object(s.c)(function(e){return e.loginState}),t=r.a.createElement(w,null);return"LOGIN"===e?t=r.a.createElement(k,null):"ALREADY_LOGIN"===e&&(t=r.a.createElement(j,null)),r.a.createElement("div",{className:"App"},t)},null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[127,2,1]]]);
//# sourceMappingURL=main.8129cc27.chunk.js.map