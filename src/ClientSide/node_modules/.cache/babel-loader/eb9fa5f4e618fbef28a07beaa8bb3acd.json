{"ast":null,"code":"import _classCallCheck from \"/home/minhduc/vng/module-11/fresher-program-2020/submissions/module-11/ducnm8/src/clientSide/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/minhduc/vng/module-11/fresher-program-2020/submissions/module-11/ducnm8/src/clientSide/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/minhduc/vng/module-11/fresher-program-2020/submissions/module-11/ducnm8/src/clientSide/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/minhduc/vng/module-11/fresher-program-2020/submissions/module-11/ducnm8/src/clientSide/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/minhduc/vng/module-11/fresher-program-2020/submissions/module-11/ducnm8/src/clientSide/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/minhduc/vng/module-11/fresher-program-2020/submissions/module-11/ducnm8/src/clientSide/src/components/Messenger/index.js\";\nimport React from 'react';\nimport ConversationList from '../ConversationList';\nimport MessageList from '../MessageList';\nimport './Messenger.css';\nimport Toolbar from '../Toolbar';\nimport ToolbarButton from '../ToolbarButton';\nimport axios from 'axios';\n\nvar Messenger =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Messenger, _React$Component);\n\n  function Messenger(props) {\n    var _this;\n\n    _classCallCheck(this, Messenger);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Messenger).call(this, props));\n    _this.state = {\n      user: props.user,\n      conversationList: []\n    };\n    console.log(_this.props.user);\n    var conversationList;\n    axios({\n      method: 'get',\n      url: 'http://localhost:8055/api/protected/list-user',\n      headers: {\n        Authorization: 'Bearer ' + _this.state.user.Token\n      }\n    }).then(function (response) {\n      conversationList = response.data.data.map(function (result) {\n        return {\n          photo: '#',\n          name: \"\".concat(result.Fullname),\n          text: '',\n          Token: _this.state.user.Token,\n          UserID: result.UserID,\n          ChatList: []\n        };\n      });\n      return conversationList;\n    }).then(function (response) {\n      var promisesArray = response.map(function (user, index) {\n        return axios({\n          method: 'post',\n          url: 'http://localhost:8055/api/protected/list-chat',\n          data: {\n            UserReceiveID: conversationList[index].UserID\n          },\n          headers: {\n            'Authorization': 'Bearer ' + _this.state.user.Token\n          }\n        }).then(function (ChatList) {\n          conversationList[index].ChatList = ChatList.data.data;\n        });\n      });\n      Promise.all(promisesArray).then(function () {\n        console.log(\"truoc\");\n        console.log(_this.state.conversationList);\n        _this.state.conversationList = conversationList;\n        console.log(_this.state.conversationList);\n        console.log(\"sau\");\n      });\n    });\n    var ws = new WebSocket(\"ws://localhost:9009/chat?token=\" + _this.props.user.token);\n\n    ws.onopen = function () {\n      console.log(\"websocket connected\");\n    };\n\n    ws.onmessage = function (chat) {\n      console.log(chat);\n      var i;\n      var conversationListCopy = _this.state.conversationList;\n\n      for (i = 0; i < conversationListCopy.length; i++) {\n        if (chat.UserSendID === conversationListCopy[i].UserID) {\n          conversationListCopy[i].ChatList.push(chat);\n          break;\n        }\n      }\n\n      _this.setState({\n        conversationList: conversationListCopy\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(Messenger, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {}\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"messenger\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101\n        },\n        __self: this\n      }, React.createElement(Toolbar, {\n        title: \"Messenger\",\n        leftItems: [React.createElement(ToolbarButton, {\n          key: \"cog\",\n          icon: \"ion-ios-cog\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 105\n          },\n          __self: this\n        })],\n        rightItems: [React.createElement(ToolbarButton, {\n          key: \"add\",\n          icon: \"ion-ios-add-circle-outline\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 108\n          },\n          __self: this\n        })],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }), React.createElement(Toolbar, {\n        title: \"Conversation Title\",\n        rightItems: [React.createElement(ToolbarButton, {\n          key: \"info\",\n          icon: \"ion-ios-information-circle-outline\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 115\n          },\n          __self: this\n        }), React.createElement(ToolbarButton, {\n          key: \"video\",\n          icon: \"ion-ios-videocam\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 116\n          },\n          __self: this\n        }), React.createElement(ToolbarButton, {\n          key: \"phone\",\n          icon: \"ion-ios-call\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 117\n          },\n          __self: this\n        })],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"scrollable sidebar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121\n        },\n        __self: this\n      }, React.createElement(ConversationList, {\n        conversationList: this.state.conversationList,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"scrollable content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }, React.createElement(MessageList, {\n        user: this.state.user,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Messenger;\n}(React.Component);\n\nexport { Messenger as default };","map":{"version":3,"sources":["/home/minhduc/vng/module-11/fresher-program-2020/submissions/module-11/ducnm8/src/clientSide/src/components/Messenger/index.js"],"names":["React","ConversationList","MessageList","Toolbar","ToolbarButton","axios","Messenger","props","state","user","conversationList","console","log","method","url","headers","Authorization","Token","then","response","data","map","result","photo","name","Fullname","text","UserID","ChatList","promisesArray","index","UserReceiveID","Promise","all","ws","WebSocket","token","onopen","onmessage","chat","i","conversationListCopy","length","UserSendID","push","setState","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport ConversationList from '../ConversationList';\nimport MessageList from '../MessageList';\nimport './Messenger.css';\nimport Toolbar from '../Toolbar';\nimport ToolbarButton from '../ToolbarButton'\nimport axios from 'axios';\n\nexport default class Messenger extends React.Component {\n  constructor(props){\n    super(props);\n    \n    \n    this.state = {\n      user: props.user,\n      conversationList: [],\n    }\n\n    console.log(this.props.user);\n\n    var conversationList;\n  \n    axios({\n      method: 'get',\n      url: 'http://localhost:8055/api/protected/list-user',\n      headers: {Authorization: 'Bearer '+this.state.user.Token}\n    }).then(response => {\n        \n        conversationList = response.data.data.map(result => {\n         \n          return {\n            photo: '#',\n            name: `${result.Fullname}`,\n            text: '',\n            Token: this.state.user.Token,\n            UserID: result.UserID,\n            ChatList: []\n          };\n        });\n        \n        \n        return conversationList;\n    }).then(response => {\n        \n\n        const promisesArray = response.map((user, index) => {\n           \n            return axios({\n              method: 'post',\n              url: 'http://localhost:8055/api/protected/list-chat',\n              data: {UserReceiveID: conversationList[index].UserID},\n              headers: {'Authorization': 'Bearer '+this.state.user.Token},\n\n            }).then(ChatList => {\n                conversationList[index].ChatList = ChatList.data.data;\n            })\n\n        });\n\n        Promise.all(promisesArray).then(() => {\n          console.log(\"truoc\");\n            console.log(this.state.conversationList);\n            this.state.conversationList = conversationList;\n            console.log(this.state.conversationList)\n            console.log(\"sau\");\n        });\n        \n    });\n\n    var ws = new WebSocket(\"ws://localhost:9009/chat?token=\"+this.props.user.token);\n    ws.onopen = () => {\n      console.log(\"websocket connected\");\n    }\n\n    ws.onmessage = (chat) => {\n      console.log(chat);\n        var i;\n\n        let conversationListCopy = this.state.conversationList;\n        for(i=0;i<conversationListCopy.length;i++){\n            if(chat.UserSendID === conversationListCopy[i].UserID){\n                conversationListCopy[i].ChatList.push(chat);\n                break;\n            }\n        }\n        this.setState({\n          conversationList: conversationListCopy,\n        });\n\n    }\n  }\n\n  componentDidMount(){\n    \n\n    \n  }\n\n  render(){\n        return (\n          <div className=\"messenger\">\n            { <Toolbar\n              title=\"Messenger\"\n              leftItems={[\n                <ToolbarButton key=\"cog\" icon=\"ion-ios-cog\" />\n              ]}\n              rightItems={[\n                <ToolbarButton key=\"add\" icon=\"ion-ios-add-circle-outline\" />\n              ]}\n            /> }\n\n            { <Toolbar\n              title=\"Conversation Title\"\n              rightItems={[\n                <ToolbarButton key=\"info\" icon=\"ion-ios-information-circle-outline\" />,\n                <ToolbarButton key=\"video\" icon=\"ion-ios-videocam\" />,\n                <ToolbarButton key=\"phone\" icon=\"ion-ios-call\" />\n              ]}\n            /> }\n\n            <div className=\"scrollable sidebar\">\n              <ConversationList conversationList={this.state.conversationList}/>\n            </div>\n\n            <div className=\"scrollable content\">\n              <MessageList user={this.state.user}/>\n            </div>\n          </div>\n        );\n      }\n}"]},"metadata":{},"sourceType":"module"}